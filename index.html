<html>
<head>
	<link rel="stylesheet" type="text/css" href="corkboard_theme.css"/>
	<link rel="stylesheet" type="text/css" href="task_list.css"/>
	<script type="text/javascript" src="external_js/jquery-1.9.0.min.js"></script>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />

	<script type="text/javascript" src="external_js/jquery-ui-1.10.0.custom.min.js"></script>
	<script type="text/javascript" src="js/jquery.blur_default.js"></script>
	<script type="text/javascript" src="external_js/date.js"></script>
	<script type="text/javascript" src="static_js/task.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="task_completion.css" />
	<script type="text/javascript">

	//wrapper tracing function
	function line(txt){
		console.log(txt);
	}

	function showPopup(){
		$("#popContainer").show();
		taskPopupRefresh();

	}

	function hidePopup(){
		$("#popContainer").hide();
	}

	function taskClaimed(id, imgurl){
		line("--taskClaimed--: " + id);
		hidePopup();
		var item = $("#taskContainer #" + id);
		item.css("background-color", "#77D");
		item.find(".taskRowInner").css("border", "1px solid #336");
		item.find(".taskDue").html("Working!")
		var complete = item.find(".taskComplete");
		complete.html("<img src='" + imgurl + "'/>");
	}

	function taskCompleted(id, imgurl){
		line("--taskComplete--: " + id);
		hidePopup();
		var item = $("#taskContainer #" + id);
		item.css("background-color", "#7D7");
		item.find(".taskRowInner").css("border", "1px solid #363");
		item.find(".taskDue").html("Complete!");		
		var complete = item.find(".taskComplete");
		complete.html("<img src='" + imgurl + "' />");
	}

	function taskClick(elem){
		//line("--click!--");
		var item = $(elem);
		//line(item.attr('id'));
		var id = item.attr('id');
		
		//TODO: Here look up the actual task, update Louis' content with it
		task = tasks[id];
		showPopup();
	}

	function updateTaskList(task){
		//line("--updateTaskList--");
		//line(task);
		var template = $("#taskRowTemplate");
		var container = $("#taskContainer");
		var taskDiv = template.clone().attr('id', task.id);			
		taskDiv.prependTo(container);
		var complete = $(taskDiv).find(".taskComplete");		
		var label = taskDiv.find(".taskLabel");
		label.html(task.name);
		var taskDue = taskDiv.find(".taskDue");		
		taskDue.html("Due: " + task.duedate);
	}

	function validateTaskInput() {
		var form = $('form#new_task');
		var txtinput = form.find('[name="taskname"]');
		var dueinput = form.find('[name="due"]');

		if (txtinput.get_default() == txtinput.val() || txtinput.val().trim().length == 0) {
			txtinput.blur_reset();
			txtinput.css('color', 'red');
			txtinput.css('font-weight', 'bold');
			return false;
		}
		return true;
	}

	function taskPopupRefresh() {
		document.getElementById("taskName").innerHTML = task.name;
	}

	function taskPopupInit() {
		// Set task variable
    	//var task = new Task('Dummy Task', 1);
    	
    	// Display Task Name
    	//document.getElementById("taskName").innerHTML = task.name;
    
    	// Disable buttons
    	document.getElementById('btnClaim').disabled = true;
    	document.getElementById('btnComplete').disabled = true;
    	
    	var currently_selected = '';
    	
    	// Selects a family member when clicked
    	$('.selectionCell').click(function(evt) {
    		currently_selected = evt.target.id;
    		if (!currently_selected)
    			return;
    		document.getElementById("selectedName").innerHTML = currently_selected;
    		$('.selectionPic').css('border-width', '0px');
    		$('.selectionPic').css('margin', '3px');
    		$('#'+currently_selected).css('border-width', '3px');
    		$('#'+currently_selected).css('margin', '0px');
    		$('#selectedPerson').attr('src', 'assets/'+currently_selected+'.jpg');

    		//$('#buttonTable').css('margin-top', '14px');
    		document.getElementById('btnClaim').disabled = false;
    		document.getElementById('btnComplete').disabled = false;
    	});
    	
		// Cancel Button
		$('#btnCancel').click(function(evt) {
    		
    	});
    	
    	// Claim Button
		$('#btnClaim').click(function(evt) {
    		task.status = 'claimed';
    		task.assignedTo = currently_selected;
    	});
    	
    	// Complete Button
		$('#btnComplete').click(function(evt) {
    		task.status = 'completed';
    		task.assignedTo = currently_selected;
    		task.finished = currently_selected;
    	});

	}
	(function($) {
		$(function() {
			editMode = false;

			// Handle the input field defaults.
			$('.remember').blur_default();

			// Insert weekdays from tomorrow till a week from today.
			var duedd = $('#due');
			var day_start = (2).day().fromNow();
			for (var i = 0; i < 5; ++i) {
				var day_name = day_start.toString('dddd');
				duedd.append('<option value="'+day_name+'">Due: '
					+day_name+'</option>');
				day_start = day_start.add(1).day();
			}
			var id = 0;
			var form = $('form#new_task');
			tasks = new Array();
			form.submit(function(e) {		
				e.preventDefault();
				if (!validateTaskInput())
					return;
				var taskInput = form.find('[name="taskname"]');
				var taskTxt = taskInput.val();
				var taskDue = form.find('[name="due"]').val();

				var task = new Task(taskTxt, null,id);
				
				task.duedate = taskDue;
				tasks[id.toString()] = task;
				updateTaskList(task);
				taskInput.blur_reset();
				++id;
			});
			
			$('.profile').click(function(evt) {
    			window.location = 'member_history.html?member=' + evt.target.id.slice(3);
    		});
    		
    		$('#titleButton').click(function(evt) {
    			window.location = 'index.html';
    		});

    		$("#popClose").click(function(evt){
    			
    		});
    		taskPopupInit();

    		$("button#edit").click(function(evt){
    			if (editMode) {
    				$("button#edit").text("Done");
    			} else {
    				$("button#edit").text("Edit");
    			}
    			editMode = !editMode;
    		});
	    });
	})(jQuery);
	</script>
	<title>Household Dashboard</title>
</head>
<body>
	<div id="outer">
	<div id="content">
		<div style="position: relative;" id="titleButton">
			<img class="pin_left" src="assets/pushpin.png">
			<h1>Household Dashboard</h1>
		</div>
		<div id="navigation">
			<div class="tabs_container">
				<ul id="tabs">
					<li>To-Do</li>
				</ul>
			</div>
			<div class="family_container">
				<ul id="family">
					<li><div class="profile" id="boxCersei"><img src="assets/Cersei.jpg" id="picCersei"><h3>Cersei</h3></div></li>
					<li><div class="profile" id="boxRobert"><img src="assets/Robert.jpg" id="picRobert"><h3>Robert</h3></div></li>
					<li><div class="profile" id="boxJoffrey"><img src="assets/Joffrey.jpg" id="picJoffrey"><h3>Joffrey</h3></div></li>
					<li><div class="profile" id="boxMyrcella"><img src="assets/Myrcella.jpg" id="picMyrcella"><h3>Myrcella</h3></div></li>
					<li><div class="profile" id="boxTommen"><img src="assets/Tommen.jpg" id="picTommen"><h3>Tommen</h3></div></li>
				</ul>
			</div>
		</div>

		<div id="tasklist">
			<div>
				<h2>To-Do</h2>
				<button id="edit" type="button">Edit</edit>
			</div>
			<div id="item_entry">
				<form id="new_task" target="index.html">
					<!--<button>?</button>-->
					<input class="remember" type="text" name="taskname" value="Enter Task Name">
					<!-- <label for="due">Due</label>-->
					<select name="due" id="due">
						<option value="ASAP">Due: ASAP</option>
						<option value="Today">Due: Today</option>
						<option value="Tomorrow">Due: Tomorrow</option>
						<!-- Javascript will add next 5 days -->
					</select>
					<button id="add_task">Add</button>
				</form>
			</div>
			<div id="taskContainer">
				<div id="taskRowTemplate" class="taskRow" onclick="javascript:taskClick(this)">
					<div class="taskRowInner">
						<div class="taskComplete"></div>
						<div class="taskLabel"></div>
						<div class="taskDue"></div>
					</div>
				</div>
			</div>		
		</div>
	</div>
	<div id="popContainer">
		<div id="popup">
			<span id="popClose">Close</span>
			<div id="taskPopup"></div>
		<div>
		</div>
	</div>
</body>
</html>
